<% content_for :title, "Issue #{ @issue.issue_number } - #{ @application_tagline }" %>


<article class='issue'>
  <div class='row'>
    <div class='small-12 columns'>

      <% if @duplicate_issues.present? %>

        <%= content_for :warning_banner do %>
          <div id="warning-banner">
            <div class="row">
              <div class="small-12 columns">
                It appears there <%= @duplicate_issues.count == 1 ? 'is already an' : 'are already' %>
                <%= 'issue'.pluralize @duplicate_issues.length %> reported for this:
                <%=
                  @duplicate_issues.collect do |duplicate_issue|
                    link_to issue_url(duplicate_issue) do
                      duplicate_issue.issue_number.to_s
                    end
                  end.to_sentence
                %>.

                If it is the same problem you can re-open and/open comment on the last reported issue and delete this one via the link at the bottom right of the page.

                If this is not a duplicate issue you can mark it so by clicking the 'not duplicate' link.

              </div>
            </div>
            <span id="close-warning-banner">&times;</span>
          </div>
        <% end %>
      <% end %>

      <div class='row'>
        <div class='medium-6 columns'>
          <%= render 'issue_title_row' %>
        </div>
        <div class='medium-6 columns'>
          <%= render 'issue_title_row' %>
        </div>
      </div>

      <div class='row'>
        <div class='medium-6 columns'>
          <%= render 'issue_categories' %>
          <%= render 'issue_contacts' %>
        </div>
        <div class='medium-6 columns'>
          <%= render 'state_control_buttons' if can? :update, Issue  %>
          <div class='row'>
            <div class="large-6 columns">
              <%= render 'issue_author_data' %>
            </div>
            <div class="large-6 columns">
              <%= render 'very_near_issues', very_near_issues: @duplicate_issues, very_near_issues_title: "Possible Duplicate" %>
              <%= render 'very_near_issues', very_near_issues: @nearby_issues, very_near_issues_title: "Nearby Issues" %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class='row'>
    <div class='medium-6 columns'>

      <div class='row'>
        <div class='large-11 columns'>
          <%= render 'issue_location_data' %>
          <%= render 'issue_description' %>
          <%= render 'issue_comments' %>
        </div>
      </div>
    </div>
    <div class='medium-6 columns'>
      <%= render 'alternative_url' %>

      <% if @issue.images.present? %>
        <div id='issue-page-images' class='owl-carousel'>
          <%= render 'issue_images' %>
        </div>
      <% end %>
    </div>
  </div>

  <div id="imageZoomModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <div id='issue-modal-images' class='owl-carousel'>
       <%= render 'issue_images', is_modal: true %>
    </div>
  </div>

  <div class='row'>
    <div class='small-12 columns'>
      <br><br>

      <div id="map-canvas" style="width: 100%; height: 400px;"></div>

      <%= render 'issue_footer_nav' %>
    </div>
  </div>
</article>

<%= render 'google_maps/markers.js', issues: @issues, this_issue: @issue %>
